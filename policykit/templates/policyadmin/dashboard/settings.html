{% extends "./dashboard_base.html" %}
{% load static %}
{% block styles %}
  <style>
  /* h2, h3 {
    padding-bottom: 1em;
  }
  .title-row {
    margin-bottom: 20px;
  }
  .card-title {
    font-family: "Nunito", sans-serif;
    font-size: 1.5em;
  }
  .card {
    margin-bottom: 24px;
  }
  .card code {
    padding-right: 1em;
    color: black;
  }
  .configList {
    list-style-type: none;
    padding-left: 0;
    margin-bottom: 0;
  }
  .btn.btn-primary {
    padding: 0.5em 2vw;
    font-family: 'Nunito', sans-serif;
    font-size: 1.2em;
    background-color: #4451b2;
    color: #ffffff;
  }
  .dropdown {
    float: right;
  }
  .dropdown-menu {
    width: 100%;
  }
  .dropdown .dropdown-item {
    font-size: 1.2em;
    font-family: 'Nunito';
  }
  .btn.btn-primary:hover {
    background-color: #3b4699;
    color: #ffffff;
  } */
  </style>
{% endblock %}
{% block content %}
  {% include "patterns/components/headers/page.html" with title="Settings" %}
  <div class="mb-52 px-6 lg:px-8" x-data="{currentTab: 'About'}">
    {% with "About Integrations Logs" as tablist %}
      {% include "patterns/components/tabs/tabs.html" with tabs=tablist.split %}
    {% endwith %}
    <div class="lg:px-4 mt-8">
      <section x-cloak x-show="currentTab == 'About'">
        <h2 class="h4 mb-8">About</h2>
        <div class="lg:grid lg:grid-cols-10">
          <div class="lg:col-span-6">
            <p class="large mb-6">
              PolicyKit empowers online community members to concisely author a wide range of governance procedures and automatically carry out those procedures on their home platforms.
            </p>
            <p>
              Inspired by Nobel economist Elinor Ostrom, we've developed a framework that describes governance as a series of actions and policies, written in short programming scripts. We're now building out an editor, software libraries, and connectors to platforms like Slack, Reddit, and Discord for communities to author actions and policies.
            </p>
          </div>
          <div class="lg:col-span-2 lg:col-start-8 space-y-8">
            <div>
              <h3 class="p font-medium mb-2">Join our community</h3>
              <div class="flex flex-col gap-1">
                <a href="https://discord.gg/p9PzjM4vcv"
                   target="_blank"
                   class="p small text-primary-dark block">Discord</a>
                <a href="https://policykit.us17.list-manage.com/subscribe/post?u=4a1d75598cb903abe5974f90d&id=07499cff74"
                   target="_blank"
                   class="p small text-primary-dark">Mailing List</a>
              </div>
            </div>
            <div>
              <h3 class="p font-medium mb-2">Contribute</h3>
              <div class="flex flex-col gap-1">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdB_BE_iKX8TaPXHkBK_t0I8lSnux_IEtV0w4Fy7zqDqFyVtQ/viewform?usp=sf_link"
                   target="_blank"
                   class="p small text-primary-dark">Feedback Form</a>
                <a href="https://github.com/amyxzhang/policykit"
                   target="_blank"
                   class="p small text-primary-dark">GitHub</a>
                <a href="https://policykit.readthedocs.io/en/latest/index.html"
                   target="_blank"
                   class="p small text-primary-dark">Documentation</a>
              </div>
            </div>
            <div>
              <h3 class="p font-medium mb-2">Our research</h3>
              <div class="flex flex-col gap-1">
                <a href="https://social.cs.washington.edu/index.html"
                   target="_blank"
                   class="p small text-primary-dark">Social Futures Lab</a>
                <a href="https://arxiv.org/abs/2008.04236"
                   target="_blank"
                   class="p small text-primary-dark">Our ACM UIST 2020 Paper</a>
                <a href="https://vimeo.com/446531759"
                   target="_blank"
                   class="p small text-primary-dark">Our ACM UIST 2020 Video</a>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section x-cloak x-show="currentTab == 'Integrations'">
        <div class="flex justify-between items-center mb-8">
          <h2 class="h4">Integrations</h2>
          <button class="button large secondary">
            {% include "patterns/icons/plus.html" with class="stroke-primary-dark" %}
            <span class="hidden lg:block">Add integration</span>
          </button>
        </div>
        <div class="col-sm-4">
          <div class="dropdown show">
            <a class="btn btn-primary dropdown-toggle"
               href="#"
               role="button"
               id="dropdownMenuLink"
               data-toggle="dropdown"
               aria-haspopup="true"
               aria-expanded="false">Add Integration</a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              {% for name, data in disabled_integrations %}
                <a class="dropdown-item"
                   href="{% url 'add_integration' %}?integration={{ name }}">
                  {% if data.readable_name %}
                    {{ data.readable_name }}
                  {% else %}
                    {{ name }}
                  {% endif %}
                </a>
              {% endfor %}
            </div>
          </div>
        </div>
        {% if request.GET.error %}
          <div class="alert alert-danger" role="alert">
            {% if request.GET.error == 'slack_wrong_community' %}
              Failed to add Slack integration. PolicyKit is already installed to the selected workspace, but for a different PolicyKit community. Contact a PolicyKit administrator for support.
            {% elif request.GET.error == 'slack_installer_is_not_admin' %}
              Failed to add Slack integration. Only Slack workspace admins are permitted to install PolicyKit.
            {% elif request.GET.error_description %}
              {{ request.GET.error_description }}
            {% else %}
              Error: {{ request.GET.error }}
            {% endif %}
          </div>
        {% endif %}
        {% if request.GET.success %}<div class="alert alert-success" role="alert">Integration added!</div>{% endif %}
        {% include "patterns/components/alert/alert.html" with alert="success" label="Blah blah" %}
        {% for name, data in enabled_integrations %}
          {% include "patterns/components/integration_widget/integration_widget.html" with name=name data=data %}
        {% endfor %}
        {% for name, data in enabled_integrations %}
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                {% if data.readable_name %}
                  {{ data.readable_name }}
                {% else %}
                  {{ name }}
                {% endif %}
              </h5>
              {% if data.config and not data.hide_config %}
                <p class="card-text">
                  <ul class="configList">
                    {% for k,v in data.config %}<li class="configListItem">{{ v }}</li>{% endfor %}
                  </ul>
                </p>
              {% endif %}
              {% if data.webhook_url %}
                <p class="card-text">
                  {% if data.webhook_instructions %}
                    <p>
                      <b>Webhook Instructions: </b>{{ data.webhook_instructions }}
                    </p>
                  {% endif %}
                  <code id="{{ name }}-webhook">{{ data.webhook_url }}</code>
                  <a class="copyToClipboard"
                     onClick="copyToClipboard('{{ name }}-webhook')"
                     href="javascript:void(0);">Copy Webhook URL</a>
                </p>
              {% endif %}
              <a href="/{{ name }}/disable_integration?id={{ data.id }}"
                 class="btn btn-sm btn-outline-danger">Delete Integration</a>
              {% if name == "opencollective" %}
                <a href="/{{ name }}/disable_integration_without_deletion?id={{ data.id }}"
                   class="btn btn-sm btn-outline-danger">Disable Integration</a>
                {{ data }}
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="card">
            <div class="card-body">No integrations enabled.</div>
          </div>
        {% endfor %}
      </section>
      <section x-cloak x-show="currentTab == 'Logs'">
        <h2 class="h4 mb-8">Logs</h2>
      </section>
    </div>
  </div>
{% endblock %}
{% block scripts %}
  <script>
  function copyToClipboard(id) {
    var copyText = document.getElementById(id)
    // https://stackoverflow.com/questions/49236100/copy-text-from-span-to-clipboard
    var textArea = document.createElement("textarea");
    textArea.value = copyText.textContent;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand("Copy");
    textArea.remove();
  }
  </script>
  <script src={% static "policyengine/js/jquery-3.4.1.min.js" %}></script>
{% endblock %}
